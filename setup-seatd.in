#!/bin/sh

if [ $(id -u) -ne 0 ]; then
   echo "this script must be run as root"
   exit 1
fi

#########################################################################################
# PROGRAM METADATA
#########################################################################################

PROGRAM=$(basename "$0")
PROGRAM_DIR=@PROGRAM_DIR@
VERSION=@VERSION@

#########################################################################################
# PROGRAM DEPENDENCIES
#########################################################################################

. "@LIB_DIR@/libusralpine.sh"

#########################################################################################
# PROGRAM 
#########################################################################################

header "$PROGRAM"


step "adding seatd"
apk add seatd || die "seatd setup - failed to install seatd"

step "adding seatd service to default"
rc-update add seatd default || die "seatd setup - failed to add seatd service to default"

step "starting seatd service"
rc-service seatd start || warn "seatd setup - failed to start seatd service. please run manually."

step "adding root to seat group"
adduser root seat || warn "seatd setup - failed to add root to seat group. please add manually."

step "adding $DOAS_USER to seat group"
adduser $DOAS_USER seat || warn "seatd setup - failed to add $DOAS_USER to seat group. please add manually."